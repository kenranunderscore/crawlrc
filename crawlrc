# TEAMCAPTAIN Ge0ff

##################################
##### Travel and Exploration #####
##################################

travel_delay = -1
explore_delay = -1
rest_delay = -1
view_delay = 500
show_travel_trail = true
travel_key_stop = true

runrest_safe_poison = 2:10
runrest_ignore_monster += ^butterfly$:1
runrest_ignore_message += contamination has completely
runrest_ignore_message += rod.*has recharged
runrest_ignore_message += your breath back
runrest_ignore_message += Your transformation is almost over
runrest_ignore_message += Your transformation has ended
runrest_ignore_message += are no longer poisoned
runrest_ignore_message += feel a strong urge
runrest_ignore_message += finish eating
runrest_ignore_message += feel your anger subside
runrest_ignore_message += feel yourself speed up
runrest_ignore_message += feel less exhausted

runrest_stop_message += starting to lose your buoyancy
runrest_stop_message += back to life
runrest_stop_message += is no longer charmed
runrest_stop_message += (starving|devoid of blood)
runrest_stop_message += wrath finds you
runrest_stop_message += lose consciousness
runrest_stop_message += hell_effect:

: if you.god() == "Xom" then
    runrest_stop_message += god:
: else
    runrest_ignore_message += god:
: end

rest_wait_both = true

auto_sacrifice = true

############################
##### General Gameplay #####
############################

default_manual_training = true

show_uncursed = true
easy_confirm = all
confirm_butcher = auto
allow_self_target = prompt
easy_eat_chunks = true
auto_eat_chunks = true

: if you.race() == "Deep Dwarf" then
    autofight_stop = 0
: else
    autofight_stop = 50
: end

autofight_warning = 50

easy_door = true
warn_hatches = true

##############################
##### Colours and Glyphs #####
##############################

allow_extended_colours = true
no_dark_brand = false
bold_brightens_foreground = true

mon_glyph += player:red

display_char = item_book   : ∞
display_char = permawall   : ▓
display_char = wall        : ░
#display_char = wall        : ▒
display_char = wall_magic  : ▒
#display_char = wall_magic  : ░

# These should match the item_glyph colours exactly when possible.
# For menu_colour, the first match ignores subsequent matches.
menu := menu_colour
menu =

# Many of the entries below come from dat/defaults/menu_colours.txt,
# which we have to duplicate here since we want only some of the
# entries from that file.
menu += notes:white:Reached XP level

### General Inventory ###
# Items currently not affecting you.
menu += darkgrey:(melded)
# Items disliked by your god.
menu += red:forbidden
# Useless items, comes here to override artefacts etc.
menu += darkgrey:.*useless.*
# Handle cursed and equipped items early to override other colour settings.
menu += lightred:.*equipped.* cursed
menu += red: (a|the) cursed
menu += inventory:lightgreen:.*equipped.*
# Colouring of autoinscribed god gifts
menu += pickup:lightred:god gift
# Highlight (partly) selected items
menu_colour += inventory:white:\w \+\s
menu_colour += inventory:white:\w \#\s

### Food ###
# Color chunks, put ordinary ones on lightgrey.
menu += red:evil_eating.*chunk
menu += blue:mutagenic.*chunk
menu += darkgrey:inedible
menu += lightgrey: +(chunks?$|chunks? +)
# These are analogous to chunks
: if you.race() == "Vampire" then
    menu += lightgrey:potions? of blood
: end

# Other food
menu += brown:fruit
menu += yellow:(pizza|jerky|jerkies)
menu += green:royal jell
menu += lightgreen:bread ration
menu += lightred:meat ration

### Potions ###
# Generally harmful
menu += blue:potions? of.*(lignification|(?<!cure|beneficial) mutation)
# Heal wounds
menu += lightred:potions? of.*heal wounds
# Mundane and ultra-rare
menu += lightgrey:potions? of.*(curing|flight)
menu += white:potions? of.*(experience|beneficial mutation)
# Damage buffs
menu += brown:potions? of.*berserk
menu += yellow:potions? of.*might
# Other buffs
menu += green:potions? of.*brilliance
menu += lightgreen:potions? of.*(invisibility|agility)
# Curing/avoiding mutations
menu += cyan:potions? of.*cancellation
menu += lightcyan:potions? of.*cure mutation
# Emergency/escape
menu += magenta:potions? of.*(magic|ambrosia)
menu += lightmagenta:potions? of.*(haste|resistance)

### Scrolls ###
# Mostly harmful
menu += blue:scroll.*noise
# Recharging
menu += lightred:scroll.*recharging
# Mundane and ultra-rare
menu += grey:scroll.*(amnesia|curse)
menu += white:scroll.*acquirement
# Damaging scrolls
: if you.race() == "Vampire"
: or you.race() == "Mummy"
: or you.race() == "Ghoul" then
    menu += blue:scroll.*holy word
    menu += brown:scroll.*torment
: else
    menu += brown:scroll.*holy word
    menu += blue:scroll.*torment
: end
menu += yellow:scroll.*summoning
# Hexes and Enchantments
menu += green:scroll.*(silence|immolation|vulnerability)
menu += lightgreen:scroll.*(enchant|brand)
# Dungeon info
menu += cyan:scroll.*identify
menu += lightcyan:scroll.*magic map
# Escape
menu += magenta:scroll.*(fog|teleport)
menu += lightmagenta:scroll.*(fear|blink)

### Wands ###
# Can be harmful, only useful early
menu += blue:wand of.*random effects
# Heal wounds
menu += lightred:wand of.*heal wounds
# Lowest-level damage and strong AOE
# 0.17
menu += lightgrey:wand of.*(flame|frost|magic dart)
menu += white:wand of.*iceblast
# High level damage
# 0.17, keep before wand of fire to avoid matching fireball
menu += brown:wand of.*(lightning|fireball)
# 0.17
menu += yellow:wand of.*(draining|cold|fire|acid)
# Hexes
menu += green:wand of.*(slowing|confusion|polymorph)
menu += lightgreen:wand of.*(invisibility|paralysis|enslavement)
# Dig/disint
menu += cyan:wand of.*(digging|disintegration)
# Escape
menu += magenta:wand of.*teleportation
menu += lightmagenta:wand of.*hasting

### General identification ###
menu += cyan:manual of
menu += lightcyan:manual
menu += lightmagenta:unidentified.*artefact.*
menu += white:.*artefact.*
menu += lightblue:unidentified .*(potion|scroll|wand|jewellery|spellbook|rod|magical staff)
menu += magenta:.*known .*(ring of (dexterity|strength|intelligence|slaying|evasion|protection(?! from))|amulet of reflection)
menu += inventory:lightgray:.*(book|jewellery|magical staff)
# Ego items
menu += lightblue:unidentified.*weapon.*(runed|glowing|enchanted)
menu += lightblue:unidentified.*armour.*(runed|glowing|embroidered|shiny|dyed)

msc := message_colour
msc += mute:returns to your side
msc += mute:a demon appears
msc += lightgrey:The deck of cards disappears
msc += mute:puff of smoke
msc += mute:carefully avoids
msc += mute:is recalled
msc += mute:wall.*burn.*your
msc += mute:dissolves? into (sparkling lights|shadows)
msc += mute:(crumbles|melts) away\.
msc += mute:(merges|forms) itself .* the air
msc += mute:you swap places
msc += mute:your.*(looks stronger|shudders|resists)
msc += mute:your.*(stumbles backwards|holds.*ground)
msc += mute:your.*(blinks|safely over)
msc += mute:(phases out.*|misses) (your|something).* msc += mute:your.*(picks up|drops)
msc += mute:your.*basks in the mutagenic energy
msc += mute:your.*(struggles|tears|pulls away).*(web|net)

channel.multiturn = mute

## For item_glyph, subsequent matches override previous ones.
item := item_glyph

## Reasonable defaults
item += potion:lightgrey
item += scroll:lightgrey
item += wand:lightgrey
item += dangerous_item:blue
item += useless_item:darkgrey

### Potions ###
item += potions? of.*(lignification|mutation):blue
item += potions? of.*heal wounds:lightred
item += potions? of.*(curing|flight):lightgrey
item += potions? of.*(experience|beneficial mutation):white
item += potions? of.*berserk:brown
item += potions? of.*might:yellow
item += potions? of.*brilliance:green
item += potions? of.*(invisibility|agility):lightgreen
item += potions? of.*cancellation:cyan
item += potions? of.*cure mutation:lightcyan
item += potions? of.*(magic|ambrosia):magenta
item += potions? of.*(haste|resistance):lightmagenta

### Scrolls ###
item += scroll.*noise:blue
item += scroll.*recharging:lightred
item += scroll.*(amnesia|curse):lightgrey
item += scroll.*acquirement:white
: if you.race() == "Vampire" or you.race() == "Mummy"
: or you.race() == "Ghoul" then
  item += scroll.*holy word:blue
  item += scroll.*torment:brown
: else
  item += scroll.*holy word:brown
  item += scroll.*torment:blue
: end
item += scroll.*(summoning):yellow
item += scroll.*(silence|vulnerability|immolation):green
item += scroll.*(enchant|brand weapon):lightgreen
item += scroll.*identify:cyan
item += scroll.*magic mapping:lightcyan
item += scroll.*(fog|teleport):magenta
item += scroll.*(fear|blink):lightmagenta

### Wands ###
item += wand of.*random effects:blue
item += wand of.*heal wounds:lightred
## 0.17
item += wand of.*(flame|frost|magic dart):lightgrey
item += wand of.*iceblast:white
## 0.17
item += wand of.*(acid|fire|cold|drain):yellow
## 0.17
item += wand of.*(lightning|fireball):brown
item += wand of.*(slowing|confusion|polymorph):green
item += wand of.*(invisibility|paralysis|enslavement):lightgreen
item += wand of.*(digging|disintegration):cyan
item += wand of.*teleportation:magenta
item += wand of.*hasting:lightmagenta

### General Identification ###
item += ( rod ):yellow
item += (identified|known).*(jewellery|magical staff):brown
item += identified.*spellbook:magenta
item += unidentified.*(potion|scroll|jewellery|wand|rod|magical staff).*:lightblue
item += unidentified.*book:lightmagenta
item += manual:lightcyan
item += manual of:cyan

# Jewelry types
item += known.*(ring of (dexterity|strength|intelligence|slaying|evasion|protection(?! from))|amulet of reflection):magenta
item += identified.*artefact.*(jewellery):white
item += unidentified.*artefact.*(jewellery).*:lightmagenta
item += (a )?stones?$:lightgray

### Food ###
item += chunks?.*flesh:lightgrey
: if you.race() == "Vampire" then
  item += potions? of blood:lightgrey
: end
item += mutagenic.*chunk:blue
item += evil_eating.*chunk:red
item += inedible.*chunk:darkgrey
item += fruit:brown
item += (pizza|jerky|jerkies):yellow
item += royal jell:green
item += bread ration:lightgreen
item += meat ration:lightred

# Want this to override anything above
item += useless:darkgrey
# Only mark these types when forbidden; for other types it looks odd.
item += forbidden.*(potion|scroll|food):red

########################
##### Inscriptions #####
########################

autoinscribe += (bad|dangerous)_item.*potion:!q
autoinscribe += (bad|dangerous)_item.*scroll:!r
autoinscribe += potion.*(berserk rage):!q

autoinscribe += of (faith|harm):!P
autoinscribe += rod:!a
autoinscribe += staff of:!a

autoinscribe += curing:@q1
autoinscribe += potions? of heal wounds:@q2
autoinscribe += potions? of haste:@q3
autoinscribe += might:@q4
autoinscribe += agility:@q5
autoinscribe += cancellation:@q6

autoinscribe += identify:@r1
autoinscribe += remove curse:@r2
autoinscribe += blinking:@r3
autoinscribe += scrolls? of teleportation:@r4

autoinscribe += wand of heal wounds:@v2
autoinscribe += wand of hasting:@v3
autoinscribe += wand of teleportation:@v4

autoinscribe += (meat|bread):@e1
autoinscribe += (beef jerky|pizza):@e2
autoinscribe += (fruit|royal jelly):@e3

##########################
##### (more) Prompts #####
##########################

show_more = false

# This section is mostly copied from gammafunk's rc file
more := force_more_message

: if you.god() == "Ashenzari" then
    more += You have a vision of.*gates?
: end

more += The mighty Pandemonium lord .* resides here

# Interrupts
more += You don't .* that spell
more += You fail to use your ability
more += You miscast.*(Blink|Borgnjor|Door|Haste|Invisibility)
more += You can't (read|drink|do)
more += You cannot .* while unable to breathe
more += You cannot .* in your current state
more += when .*silenced
more += too confused
more += There's something in the way
more += There's nothing to (close|open) nearby
more += not good enough to have a special ability
more += You are too berserk
more += no means to grasp
more += That item cannot be evoked
more += This wand has no charges
more += You are held in a net
more += You don't have any such object
more += You can't unwield
more += enough magic points
more += You don't have the energy to cast that spell

# Bad things
more += Your surroundings flicker
more += You cannot teleport right now
more += A sentinel's mark forms upon you
more += (blundered into a|invokes the power of) Zot
more += enter a teleport trap
more += Ouch! That really hurt!
more += dispelling energy hits you
more += You are blasted by holy energy!
more += You are (blasted|electrocuted)!
more += You are (?!no longer).*(confused|poisoned)
more += flesh rotting
more += (starving|devoid of blood)
more += god:(sends|finds|silent|anger)
more += You feel a surge of divine spite
more += disloyal to dabble
more += lose consciousness
more += You are too injured to fight blindly
more += calcifying dust hits
more += Space warps.*around you
more += Space bends around you
more += watched by something
more += flickers and vanishes!
more += doesn't seem very happy
more += is no longer charmed

# Hell effects
more += hell_effect:

# Expiring effects
more += You feel yourself slow down
more += You are starting to lose your buoyancy
more += Your hearing returns
more += Your transformation is almost over
more += You have a feeling this form
more += You feel yourself come back to life
more += time is quickly running out
more += life is in your own hands
more += Your shroud falls apart
more += You start to feel a little slower
more += You feel less protected from missiles

# Others
more += You have reached level
more += You rejoin the land of the living
more += You have finished (your manual|forgetting about)
more += Your scales start
more += You feel monstrous
more += Jiyva alters your body
: if you.god() == "Xom" then
  more += god:
: end

# Problematic monsters
more += (giant eyeball|shining eye|cacodemon|neqoxec|guardian serpent|flayed ghost|greater mummy|mummy priest|hell sentinel|fiend|tzitzimitl|tormentor|hellion|lich|executioner|orb of fire|death cob|juggernaut|moth of wrath|ghost moth|curse toe|curse skull|draconian shifter).*into view

## Any uniques and any pan lords
more += (?-i:[A-Z]).* comes? into view

## 0.17
more += the royal jelly.* comes? into view

####################
##### Webtiles #####
####################

tile_font_crt_family = Consolas
tile_font_stat_family = Consolas
tile_font_msg_family = Consolas
tile_font_lbl_family = Consolas

####################
##### Lua code #####
####################

{
    ---------------------------------------
    ---- Begin conditional force_mores ----
    ---------------------------------------

    -- See README.md for documentation.

    last_turn = you.turns()

    -- Each entry must have a name field with a descriptive name, a pattern field
    -- giving the regexp matching the appropriate monster(s), a cond field giving
    -- the condition type, and a cutoff field giving the max value where the
    -- force-more is active. Possible values for cond are xl and maxhp. Note that
    -- the final pattern will be "(pattern).*into view" where pattern is the value
    -- from the entry.

    fm_patterns = {
      -- General early game threats
      {pattern = "adder|gnoll|hound", cond = "xl", cutoff = 2,
       name = "XL1"},
      -- Problems for chars with 20, 60, 90, or 120 mhp
      {pattern = "orc|Ogre", cond = "maxhp", cutoff = 20, name = "20mhp"},
      {pattern = "orc priest", cond = "maxhp", cutoff = 40, name = "40mhp"},
      {pattern = "centaur [^wzs]|drake|blink frog|spiny frog|basilisk" ..
         "|raven|komodo dragon|blink frog|snapping turtle|black mamba" ..
         "|(redback|trapdoor) spider|hill giant|deep elf (summoner|mage)" ..
         "|gargoyle|sixfirhy|sun demon",
       cond = "maxhp", cutoff = 60, name = "60mhp"},
      {pattern = "hydra|death yak|tarantella|(wolf|orb|jumping) spider" ..
         "|alligator|catoblepas|(fire|ice) dragon|spriggan (rider|druid)" ..
         "|torpor|yaktaur|vault guard|manticore|harpy|faun|merfolk|siren" ..
         "|water nymph|mana viper|a wizard|[0-9]+ wizards|ogre mage" ..
         "|deep elf (knight|conjurer)|tengu conjurer|green death" ..
         "|shadow demon",
       cond = "maxhp", cutoff = 90, name = "90mhp"},
      {pattern = "centaur warrior|yaktaur captain" ..
         "|(quicksilver|storm|shadow|iron) dragon|alligator snapping turtle" ..
         "|satyr|naga sharpshooter|merfolk avatar|anaconda|shock serpent" ..
         "|emperor scorpion(stone|frost|fire) giant|titan|entropy weaver" ..
         "|thorn hunter|sphinx|war gargoyle|preserver" ..
         "|vault (warden|sentinel)|convoker|monstrosity|tengu reaver" ..
         "|deep elf (master archer|blademaster|death mage" ..
         "|sorcerer|demonologist|annihilator)" ..
         "|octopode crusher|yaktaur captain|spriggan (defender|air mage)" ..
         "|reaper|balrug",
       cond = "maxhp", cutoff = 120, name = "120mhp"}
    } -- end fm_patterns

    active_fm = {}
    -- Set to true to get a message when the fm change
    notify_fm = false

    -- Wrapper of crawl.mpr() that prints text in white by default.
    if not mpr then
      mpr = function (msg, color)
        if not color then
          color = "white"
        end
        crawl.mpr("<" .. color .. ">" .. msg .. "</" .. color .. ">")
      end
    end

    function init_force_mores()
      for i,v in ipairs(fm_patterns) do
        active_fm[#active_fm + 1] = false
      end
    end

    function update_force_mores()
      local activated = {}
      local deactivated = {}
      local hp, maxhp = you.hp()
      for i,v in ipairs(fm_patterns) do
        local msg = "(" .. v.pattern .. ").*into view"
        local action = nil
        local fm_name = v.pattern
        if v.name then
          fm_name = v.name
        end
        if not v.cond and not active_fm[i] then
          action = "+"
        elseif v.cond == "xl" then
          if active_fm[i] and you.xl() >= v.cutoff then
            action = "-"
          elseif not active_fm[i] and you.xl() < v.cutoff then
            action = "+"
          end
        elseif v.cond == "maxhp" then
          if active_fm[i] and maxhp >= v.cutoff then
            action = "-"
          elseif not active_fm[i] and maxhp < v.cutoff then
            action = "+"
          end
        end
        if action == "+" then
          activated[#activated + 1] = fm_name
        elseif action == "-" then
          deactivated[#deactivated + 1] = fm_name
        end
        if action ~= nil then
          local opt = "force_more_message " .. action .. "= " .. msg
          crawl.setopt(opt)
          active_fm[i] = not active_fm[i]
        end
      end
      if #activated > 0 and notify_fm then
        mpr("Activating force_mores: " .. table.concat(activated, ", "))
      end
      if #deactivated > 0 and notify_fm then
        mpr("Deactivating force_mores: " .. table.concat(deactivated, ", "))
      end
    end

    local last_turn = nil
    function force_mores()
      if last_turn ~= you.turns() then
        update_force_mores()
        last_turn = you.turns()
      end
    end

    init_force_mores()

    -------------------------
    ---- End force_mores ----
    -------------------------
}

{
    function ready()
        
        -- Taken from github.com/gammafunk/dcss-rc      
        force_mores()

    end
}
